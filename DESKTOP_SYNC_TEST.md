# 桌面映射功能测试指南

## 功能概述
桌面映射功能允许在程序页面上添加的组件内容同步展示在桌面上，包括位置、透明度等属性的实时同步。

## 测试步骤

### 1. 启动应用程序
- 运行 `dotnet run --configuration Release`
- 确保应用程序成功启动并显示主窗口

### 2. 添加组件
- 点击"添加时钟"按钮添加时钟组件
- 点击"添加番茄时钟"按钮添加番茄时钟组件
- 验证组件在主窗口中正确显示

### 3. 测试桌面映射
- 点击"隐藏/显示"按钮切换到桌面模式
- 验证主窗口隐藏，桌面覆盖层显示
- 确认所有组件都正确显示在桌面上

### 4. 测试位置同步
- 切换回主窗口模式
- 拖动组件到不同位置
- 再次切换到桌面模式
- 验证组件位置在桌面上正确同步

### 5. 测试透明度同步
- 在主窗口中选择一个组件
- 调整透明度滑块
- 切换到桌面模式
- 验证透明度变化在桌面上正确同步

### 6. 测试实时同步（新功能）
- 保持桌面模式开启
- 切换回主窗口（不关闭桌面模式）
- 拖动组件位置
- 观察桌面上的组件是否实时跟随移动
- 调整组件透明度
- 观察桌面上的组件透明度是否实时更新

### 7. 测试组件设置同步
- 双击组件打开设置窗口
- 修改组件设置（如时钟显示日期、番茄时钟工作时长等）
- 保存设置
- 验证设置变化在桌面组件上正确反映

## 预期效果

### 基本同步
- ✅ 组件位置在主窗口和桌面之间准确同步
- ✅ 组件透明度在主窗口和桌面之间准确同步
- ✅ 组件内容（时间显示、番茄时钟状态等）在桌面上正确显示

### 实时同步（新增）
- ✅ 拖动组件时，桌面上的对应组件实时跟随移动
- ✅ 调整透明度时，桌面上的组件透明度实时更新
- ✅ 组件设置变化时，桌面组件立即反映新设置

### 交互体验
- ✅ 桌面组件保持交互功能（如番茄时钟的开始/暂停按钮）
- ✅ 双击桌面组件可以打开设置窗口
- ✅ 组件在桌面上的显示效果与主窗口一致

## 技术特点

### 同步机制
- **位置同步**: 通过 `PositionChanged` 事件实现拖动后的位置同步
- **透明度同步**: 通过 `SyncWidgetToOverlay` 方法实现透明度变化同步
- **数据同步**: 通过共享 Model 实现组件数据的实时同步
- **属性监听**: 通过 `PropertyChanged` 事件监听模型属性变化

### 性能优化
- 使用事件驱动的同步机制，避免轮询
- 只在覆盖窗口可见时进行同步操作
- 通过 Dispatcher 确保 UI 线程安全

## 故障排除

### 如果组件不同步
1. 检查是否正确订阅了 `PositionChanged` 事件
2. 确认 `SyncWidgetToOverlay` 方法被正确调用
3. 验证覆盖窗口是否正确显示

### 如果透明度不生效
1. 检查透明度值是否在有效范围内（0.1-1.0）
2. 确认 `GlobalOpacitySlider_ValueChanged` 事件正确处理
3. 验证组件选择状态是否正确

### 如果设置不同步
1. 确认组件使用共享的 Model 实例
2. 检查 `PropertyChanged` 事件是否正确触发
3. 验证设置窗口的保存逻辑是否正确执行